"use strict";
const _ = require("lodash");
const dateFormat = require("dateformat");
const fs = require("fs");
const path = require("path");
const stackTrace = require("stack-trace");
const winston = require("winston");
let config = {
    'default': 'info'
};
const mkLogConfig = (label, level) => {
    return {
        level: level,
        transports: [
            new (winston.transports.Console)({
                colorize: true,
                label: label,
                timestamp: () => {
                    var now = new Date();
                    return dateFormat(now, 'HH:MM:ss.l');
                }
            })
        ]
    };
};
const logger = addLogger('LOG_FACTORY');
const setConfig = (cfg) => {
    config = _.merge({}, config, cfg);
    _.forIn(cfg, (value, key) => {
        addLogger(key, value);
    });
};
const isLogLevel = (l) => _.includes(['error', 'warn', 'info', 'verbose', 'debug', 'silly'], l);
exports.setDefaultLevel = (l) => {
    config = _.merge(config, { 'default': l });
    logger.debug('default level now: ', config['default']);
    _.forEach(winston.loggers.loggers, (value, key) => {
        let logger = winston.loggers.get(key);
        let cfg = mkLogConfig(key, config['default']);
        logger.configure(cfg);
    });
};
exports.init = (log) => {
    logger.debug('init: ', log);
    if (!log) {
        return;
    }
    if (_.isObject(log)) {
        setConfig(log);
    }
    else if (isLogLevel(log)) {
        exports.setDefaultLevel(log);
    }
    else {
        try {
            let config = JSON.parse(log);
            logger.debug('parsed log: ', log);
            setConfig(config);
        }
        catch (e) {
            if (fs.existsSync(log)) {
                var cfg = JSON.parse(fs.readFileSync(log, 'utf8'));
                setConfig(cfg);
            }
            else {
                console.error('can not configure logging using cli param value: ' + log);
            }
        }
    }
};
function addLogger(label, level) {
    level = level ? level : config['default'] || 'info';
    let cfg = mkLogConfig(label, level);
    let logger;
    if (winston.loggers.has(label)) {
        logger = winston.loggers.get(label);
    }
    else {
        logger = winston.loggers.add(label, {});
    }
    logger.configure(cfg);
    return logger;
}
exports.getLogger = (id) => {
    var existing = winston.loggers.has(id);
    if (existing) {
        return winston.loggers.get(id);
    }
    else {
        return addLogger(id, config[id] || config['default']);
    }
};
exports.fileLogger = (filename) => {
    var label;
    var parsed = path.parse(filename);
    if (parsed.name === 'index') {
        label = path.basename(parsed.dir);
    }
    else {
        label = parsed.name;
    }
    return exports.getLogger(label);
};
function buildLogger() {
    let trace = stackTrace.get();
    let name = trace[1].getFileName();
    return exports.fileLogger(name);
}
exports.buildLogger = buildLogger;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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N0IsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxrQkFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzFCLENBQUM7QUFKRCxrQ0FJQyIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCAqIGFzIGRhdGVGb3JtYXQgZnJvbSAnZGF0ZWZvcm1hdCc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgc3RhY2tUcmFjZSBmcm9tICdzdGFjay10cmFjZSc7XG5pbXBvcnQgKiBhcyB3aW5zdG9uIGZyb20gJ3dpbnN0b24nO1xuLy9sZXZlbHM6IGVycm9yID4gd2FybiA+IGluZm8gPiB2ZXJib3NlID4gZGVidWcgPiBzaWxseVxuXG5sZXQgY29uZmlnID0ge1xuICAnZGVmYXVsdCc6ICdpbmZvJ1xufTtcblxuY29uc3QgbWtMb2dDb25maWcgPSAobGFiZWw6IHN0cmluZywgbGV2ZWw6IHN0cmluZykgPT4ge1xuICByZXR1cm4ge1xuICAgIGxldmVsOiBsZXZlbCxcbiAgICB0cmFuc3BvcnRzOiBbXG4gICAgICBuZXcgKHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKSh7XG4gICAgICAgIGNvbG9yaXplOiB0cnVlLFxuICAgICAgICBsYWJlbDogbGFiZWwsXG4gICAgICAgIHRpbWVzdGFtcDogKCkgPT4ge1xuICAgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgIHJldHVybiBkYXRlRm9ybWF0KG5vdywgJ0hIOk1NOnNzLmwnKTtcbiAgICAgICAgfS8vJ1RUVCcsIC8vRGF0ZS5ub3coKSxcbiAgICAgIH0pXG4gICAgXVxuICB9O1xufTtcblxuLy8gY29uc3QgbG9nZ2VyID0gbmV3ICh3aW5zdG9uLkxvZ2dlcikoe1xuLy8gICB0cmFuc3BvcnRzOiBbXG4vLyAgICAgbmV3ICh3aW5zdG9uLnRyYW5zcG9ydHMuQ29uc29sZSkoe1xuLy8gICAgICAgdGltZXN0YW1wOiBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgIHJldHVybiBEYXRlLm5vdygpO1xuLy8gICAgICAgfSxcbi8vICAgICAgIGZvcm1hdHRlcjogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbi8vICAgICAgICAgLy8gUmV0dXJuIHN0cmluZyB3aWxsIGJlIHBhc3NlZCB0byBsb2dnZXIuXG4vLyAgICAgICAgIHJldHVybiBvcHRpb25zLnRpbWVzdGFtcCgpICsgJyAnICsgb3B0aW9ucy5sZXZlbC50b1VwcGVyQ2FzZSgpICsgJyAnICsgKG9wdGlvbnMubWVzc2FnZSA/IG9wdGlvbnMubWVzc2FnZSA6ICcnKSArXG4vLyAgICAgICAgICAgKG9wdGlvbnMubWV0YSAmJiBPYmplY3Qua2V5cyhvcHRpb25zLm1ldGEpLmxlbmd0aCA/ICdcXG5cXHQnICsgSlNPTi5zdHJpbmdpZnkob3B0aW9ucy5tZXRhKSA6ICcnKTtcbi8vICAgICAgIH1cbi8vICAgICB9KVxuLy8gICBdXG4vLyB9KTtcblxuY29uc3QgbG9nZ2VyID0gYWRkTG9nZ2VyKCdMT0dfRkFDVE9SWScpO1xuXG5jb25zdCBzZXRDb25maWcgPSAoY2ZnKSA9PiB7XG4gIGNvbmZpZyA9IF8ubWVyZ2Uoe30sIGNvbmZpZywgY2ZnKTtcbiAgXy5mb3JJbihjZmcsICh2YWx1ZSwga2V5KSA9PiB7XG4gICAgYWRkTG9nZ2VyKGtleSwgdmFsdWUpO1xuICB9KTtcbn07XG5cbmNvbnN0IGlzTG9nTGV2ZWwgPSAobCk6IEJvb2xlYW4gPT4gXy5pbmNsdWRlcyhbJ2Vycm9yJywgJ3dhcm4nLCAnaW5mbycsICd2ZXJib3NlJywgJ2RlYnVnJywgJ3NpbGx5J10sIGwpO1xuXG5leHBvcnQgY29uc3Qgc2V0RGVmYXVsdExldmVsID0gKGwpID0+IHtcbiAgY29uZmlnID0gXy5tZXJnZShjb25maWcsIHsgJ2RlZmF1bHQnOiBsIH0pO1xuICBsb2dnZXIuZGVidWcoJ2RlZmF1bHQgbGV2ZWwgbm93OiAnLCBjb25maWdbJ2RlZmF1bHQnXSk7XG4gIF8uZm9yRWFjaCh3aW5zdG9uLmxvZ2dlcnMubG9nZ2VycywgKHZhbHVlLCBrZXkpID0+IHtcbiAgICBsZXQgbG9nZ2VyID0gd2luc3Rvbi5sb2dnZXJzLmdldChrZXkpO1xuICAgIGxldCBjZmcgPSBta0xvZ0NvbmZpZyhrZXksIGNvbmZpZ1snZGVmYXVsdCddKTtcbiAgICBsb2dnZXIuY29uZmlndXJlKGNmZyk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGluaXQgPSAobG9nKTogdm9pZCA9PiB7XG5cbiAgbG9nZ2VyLmRlYnVnKCdpbml0OiAnLCBsb2cpO1xuXG4gIGlmICghbG9nKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKF8uaXNPYmplY3QobG9nKSkge1xuICAgIHNldENvbmZpZyhsb2cpO1xuICB9IGVsc2UgaWYgKGlzTG9nTGV2ZWwobG9nKSkge1xuICAgIHNldERlZmF1bHRMZXZlbChsb2cpO1xuICB9IGVsc2Uge1xuICAgIHRyeSB7XG4gICAgICBsZXQgY29uZmlnID0gSlNPTi5wYXJzZShsb2cpO1xuICAgICAgbG9nZ2VyLmRlYnVnKCdwYXJzZWQgbG9nOiAnLCBsb2cpO1xuICAgICAgc2V0Q29uZmlnKGNvbmZpZyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMobG9nKSkge1xuICAgICAgICB2YXIgY2ZnID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMobG9nLCAndXRmOCcpKTtcbiAgICAgICAgc2V0Q29uZmlnKGNmZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdjYW4gbm90IGNvbmZpZ3VyZSBsb2dnaW5nIHVzaW5nIGNsaSBwYXJhbSB2YWx1ZTogJyArIGxvZyk7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5cbmZ1bmN0aW9uIGFkZExvZ2dlcihsYWJlbCwgbGV2ZWw/OiBzdHJpbmcpOiB3aW5zdG9uLkxvZ2dlckluc3RhbmNlIHtcbiAgbGV2ZWwgPSBsZXZlbCA/IGxldmVsIDogY29uZmlnWydkZWZhdWx0J10gfHwgJ2luZm8nO1xuICBsZXQgY2ZnID0gbWtMb2dDb25maWcobGFiZWwsIGxldmVsKTtcbiAgbGV0IGxvZ2dlcjtcbiAgaWYgKHdpbnN0b24ubG9nZ2Vycy5oYXMobGFiZWwpKSB7XG4gICAgbG9nZ2VyID0gd2luc3Rvbi5sb2dnZXJzLmdldChsYWJlbCk7XG4gIH0gZWxzZSB7XG4gICAgbG9nZ2VyID0gd2luc3Rvbi5sb2dnZXJzLmFkZChsYWJlbCwge30pO1xuICB9XG5cbiAgbG9nZ2VyLmNvbmZpZ3VyZShjZmcpO1xuICByZXR1cm4gbG9nZ2VyO1xufVxuXG4vKiogZ2V0IGEgbG9nZ2VyIGFuZCBnaXZlIGl0IGEgbmFtZSAqL1xuZXhwb3J0IGNvbnN0IGdldExvZ2dlciA9IChpZDogc3RyaW5nKTogd2luc3Rvbi5Mb2dnZXJJbnN0YW5jZSA9PiB7XG4gIHZhciBleGlzdGluZyA9IHdpbnN0b24ubG9nZ2Vycy5oYXMoaWQpO1xuXG4gIGlmIChleGlzdGluZykge1xuICAgIHJldHVybiB3aW5zdG9uLmxvZ2dlcnMuZ2V0KGlkKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYWRkTG9nZ2VyKGlkLCBjb25maWdbaWRdIHx8IGNvbmZpZ1snZGVmYXVsdCddKTtcbiAgfVxufTtcblxuLyoqIGdldCBhIGxvZ2dlciBhbmQgbmFtZSBpdCBieSBpdCdzIGZpbGUgbmFtZS4gKi9cbmV4cG9ydCBjb25zdCBmaWxlTG9nZ2VyID0gKGZpbGVuYW1lKTogd2luc3Rvbi5Mb2dnZXJJbnN0YW5jZSA9PiB7XG4gIHZhciBsYWJlbDtcbiAgdmFyIHBhcnNlZCA9IHBhdGgucGFyc2UoZmlsZW5hbWUpO1xuXG4gIGlmIChwYXJzZWQubmFtZSA9PT0gJ2luZGV4Jykge1xuICAgIGxhYmVsID0gcGF0aC5iYXNlbmFtZShwYXJzZWQuZGlyKTtcbiAgfSBlbHNlIHtcbiAgICBsYWJlbCA9IHBhcnNlZC5uYW1lO1xuICB9XG4gIHJldHVybiBnZXRMb2dnZXIobGFiZWwpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgYSBsb2dnZXIgYW5kIGF1dG9tYXRpY2FsbHkgbmFtZSBpdCBieSB1c2luZyB0aGUgZmlsZW5hbWUgb2YgdGhlIGNhbGwgc2l0ZS5cbiAqIEVnOiBcbiAqIGBgYFxuICogLy9teS1maWxlLmpzXG4gKiBpbXBvcnQge2J1aWxkTG9nZ2VyfSBmcm9tICdsb2ctZmFjdG9yeSc7XG4gKiBsZXQgbG9nZ2VyID0gYnVpbGRMb2dnZXIoKTtcbiAqIGxvZ2dlci5pbmZvKCdoaScpIC8vPT4gZW1pdHMgW0lORk9dIFtteS1maWxlXSBoaSBcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRMb2dnZXIoKTogd2luc3Rvbi5Mb2dnZXJJbnN0YW5jZSB7XG4gIGxldCB0cmFjZSA9IHN0YWNrVHJhY2UuZ2V0KCk7XG4gIGxldCBuYW1lID0gdHJhY2VbMV0uZ2V0RmlsZU5hbWUoKTtcbiAgcmV0dXJuIGZpbGVMb2dnZXIobmFtZSk7XG59XG4iXX0=
